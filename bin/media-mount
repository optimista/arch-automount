#!/bin/sh
#$1 = <dev>

# Directory to use for mounting the devices
dev="/dev/$1"
devlabel=$( lsblk -no label $dev ) 
devuuid=$( lsblk -no uuid $dev )
if [ -z $devlabel ]; then label=$devuuid; else label=$devlabel; fi
label=$( echo $label | tr '[:upper:]' '[:lower:]' )
dir="/media/$label"

mkdir -p "$dir"
mount "$dev" "$dir"

for u in /home/*; do
	echo $u >> /home/crux/local
	echo $dir >> /home/crux/local
	echo $(basename $dir) >> /home/crux/local
	ln -s $dir "$u/+$(basename $dir)"
done

exit 0
